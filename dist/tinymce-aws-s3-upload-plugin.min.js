'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};tinymce.PluginManager.add('AwsS3Upload',function(a,b){var _a$getParam=a.getParam('Awss3UploadSettings'),c=_a$getParam.bucketName,_a$getParam$folderNam=_a$getParam.folderName,h=_a$getParam$folderNam===void 0?'':_a$getParam$folderNam,d=_a$getParam.awsAuth,_a$getParam$buttonTex=_a$getParam.buttonText,i=_a$getParam$buttonTex===void 0?'Upload File':_a$getParam$buttonTex,f=_a$getParam.progress,g=_a$getParam.secondFileSelectedBeforeFirstUpload,j=!1;if(!c)return console.log('`bucketName` parameter missing on init AwsS3Upload TinyMCE plugin.'),!1;if(d&&'object'==('undefined'==typeof d?'undefined':_typeof(d))){var o=d.secretAccessKey,p=d.accessKeyId,q=d.region;if(!p)return console.log('`awsAuth` parameter missing `accessKeyId` property on init AwsS3Upload TinyMCE plugin.'),!1;if(!o)return console.log('`awsAuth` parameter missing `secretAccessKey` property on init AwsS3Upload TinyMCE plugin.'),!1;if(!q)return console.log('`awsAuth` parameter missing `secretAccessKey` property on init AwsS3Upload TinyMCE plugin.'),!1;AWS.config.region=q,AWS.config.update({accessKeyId:p,secretAccessKey:o})}var k=a.targetElm,l=document.createElement('input');l.type='file',l.style.cssText='display:none',k.parentNode.insertBefore(l,k);var m=document.createElement('progress');m.max=100,m.value=10,m.style.cssText='display:none',k.parentNode.insertBefore(m,k);var n=new AWS.S3({params:{Bucket:c}});l.addEventListener('change',function(o){o.preventDefault();var p=l.files[0],q=a.contentAreaContainer;if(p){q.parentNode.insertBefore(m,q),f.bar&&'boolean'==typeof f.bar&&(m.style.cssText='display:block;position: absolute;z-index: 9999;width: 120px;height: 15px;right: 10px;top:45px'),j=!0;var r=p.name.split('.').pop(),s=p.name.split('.'+r)[0],t=h+'/'+s+'-'+Date.now()+'.'+r,u={Key:t,ContentType:p.type,Body:p,ACL:'public-read'};n.putObject(u).on('httpUploadProgress',function(v){var w=parseInt(100*(v.loaded/v.total));m.value=w,f.callback&&'function'==typeof f.callback&&f.callback(w)}).send(function(v,w){j=!1,m.style.cssText='display:none',v?f.errorCallback&&'function'==typeof f.errorCallback&&f.errorCallback(v):f.successCallback&&'function'==typeof f.successCallback&&f.successCallback(a,'https://s3.amazonaws.com/'+c+'/'+t)})}}),a.addButton('AwsS3UploadButton',{text:i,icon:!1,onclick:function onclick(){j?g.callback&&'function'==typeof g.callback?g.callback():alert('Progress allready'):l.click()}})});
