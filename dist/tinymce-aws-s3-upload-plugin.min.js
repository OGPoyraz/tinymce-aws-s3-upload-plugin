'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};tinymce.PluginManager.add('AwsS3Upload',function(a,b){function c(u){var v='number'==typeof p.min&&u.size<p.min||'number'==typeof p.max&&u.size>p.max;if(v){var w=new RangeError('The content length of \''+u.name+'\' must be between '+p.min+' and '+p.max+' bytes.');throw p.errorCallback&&'function'==typeof p.errorCallback&&p.errorCallback(w),w}}function d(u,v){switch(v.split('.').pop()){case'png':case'jpg':case'jpeg':{u.execCommand('mceInsertContent',!1,'<img src="'+v+'" style="display: block;margin: 0 auto;text-align: center; max-width:100%;" />');break}default:u.execCommand('mceInsertContent',!1,'<a href="'+v+'">'+v+'</a>');}}var _a$getParam=a.getParam('Awss3UploadSettings'),f=_a$getParam.bucketName,_a$getParam$folderNam=_a$getParam.folderName,j=_a$getParam$folderNam===void 0?'':_a$getParam$folderNam,g=_a$getParam.awsAuth,_a$getParam$buttonTex=_a$getParam.buttonText,k=_a$getParam$buttonTex===void 0?'Upload File':_a$getParam$buttonTex,_a$getParam$condition=_a$getParam.conditions,l=_a$getParam$condition===void 0?{}:_a$getParam$condition,h=_a$getParam.progress,i=_a$getParam.secondFileSelectedBeforeFirstUpload,m=g.secretAccessKey,n=g.accessKeyId,o=g.region,_l$contentLengthRange=l.contentLengthRange,p=_l$contentLengthRange===void 0?{min:0,max:null}:_l$contentLengthRange,q=!1;if(!f)return console.log('`bucketName` parameter missing on init AwsS3Upload TinyMCE plugin.'),!1;if(g&&'object'==('undefined'==typeof g?'undefined':_typeof(g))){if(!n)return console.log('`awsAuth` parameter missing `accessKeyId` property on init AwsS3Upload TinyMCE plugin.'),!1;if(!m)return console.log('`awsAuth` parameter missing `secretAccessKey` property on init AwsS3Upload TinyMCE plugin.'),!1;if(!o)return console.log('`awsAuth` parameter missing `secretAccessKey` property on init AwsS3Upload TinyMCE plugin.'),!1;AWS.config.update({region:o,accessKeyId:n,secretAccessKey:m})}var r=a.targetElm,s=document.createElement('input');s.type='file',s.style.cssText='display:none',r.parentNode.insertBefore(s,r);var t=document.createElement('progress');t.max=100,t.value=10,t.style.cssText='display:none',r.parentNode.insertBefore(t,r),s.addEventListener('change',function(u){u.preventDefault();var v=s.files[0],w=a.contentAreaContainer;if(v){c(v),w.parentNode.insertBefore(t,w),h.bar&&'boolean'==typeof h.bar&&(t.style.cssText='display:block;position: absolute;z-index: 9999;width: 120px;height: 15px;right: 10px;top:45px'),q=!0;var x=v.name.split('.').pop(),y=v.name.split('.'+x)[0],z=(j?j+'/':'')+y+'-'+Date.now()+'.'+x,A=new AWS.S3.ManagedUpload({params:{Bucket:f,Key:z,Body:v,ContentType:v.type,ACL:'public-read'}}),B=A.promise();B.then(function(C){var D=C.Location;q=!1,t.style.cssText='display:none',h&&h.successCallback?h.successCallback(a,D):d(a,D)},function(C){return alert('There was an error uploading your photo: ',C.message)})}}),a.ui.registry.addButton('AwsS3UploadButton',{text:k,onAction:function onAction(){q?i.callback&&'function'==typeof i.callback?i.callback():alert('Progress allready'):s.click()}})});
